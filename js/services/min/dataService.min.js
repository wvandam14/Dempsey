soccerStats.factory("dataService",function(e,t,s,a,o,r,n){var l={U12:"U12",U16:"U16",U18:"U18",U20:"U20",U23:"U23"},c={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District Of Columbia",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},i=function(){return Parse.User.current()},u={},d={},m=Parse.Object.extend("Players"),g=Parse.Object.extend("_User"),y=Parse.Object.extend("Team"),p=Parse.Object.extend("SeasonPlayerStats"),h=Parse.Object.extend("Game"),f=Parse.Object.extend("SeasonTeamStats"),b=Parse.Object.extend("GameTeamStats"),P=Parse.Object.extend("GamePlayerStats"),v=function(e){u=e},S=function(){return u},w=function(e){d=e},T=function(){return d},I=function(e){var s=[],a=new Parse.Query(g),r=Parse.User.current();return a.include("teams"),a.get(r.id,{success:function(a){t(function(){var t=a.get("teams");_.each(t,function(e){s.push(e)}),e(s)})},error:function(e,t){o.error("There was an error ("+t.code+"). Please try again.")}}),s},N=function(e){var s=[],a=Parse.User.current(),o=new Parse.Query(g);return o.include("players"),o.get(a.id,{success:function(a){t(function(){var t=a.get("players");_.each(t,function(e){var t=e.get("photo"),a=e.get("name"),o=e.get("birthday"),r=e.get("team"),n=e.get("jerseyNumber"),l=e.get("city"),c=e.get("state"),i={emergencyContact:e.get("emergencyContact"),phone:e.get("phone"),relationship:e.get("relationship")};s.push({photo:t,name:a,birthday:o,team:r,jerseyNumber:n,city:l,state:c,contact:i,id:e.id})}),e(s)})},error:function(){}}),s},C=function(e,t){var s=new y,a=new Parse.Query(h);s.id=e.id,s.fetch().then(function(e){a.equalTo("team",e),a.include("gameTeamStats"),a.find().then(function(s){for(var a,o=[],r=0;r<s.length;r++)a={id:s[r].id,date:s[r].get("date"),opponent:{name:s[r].get("opponent"),symbol:s[r].get("opponentSymbol"),score:s[r].get("gameTeamStats").get("goalsTaken")},team:{name:e.get("name"),symbol:e.get("symbol"),score:s[r].get("gameTeamStats").get("goalsMade")},status:s[r].get("status"),notes:s[r].get("gameNotes")},o.push(a);t(o)},function(e){console.log("Error: "+e.code+" "+e.message),o.error("There was a an error ("+e.code+"). Please try again.")})})},B=function(e,t){var s=new Parse.Query(y);s.include("teamStats"),s.include("teamStats.topAssists"),s.include("teamStats.topAssists.playerStats"),s.include("teamStats.topGoals"),s.include("teamStats.topGoals.playerStats"),s.include("teamStats.topShots"),s.include("teamStats.topShots.playerStats"),s.equalTo("objectId",e),s.first().then(function(e){e.get("teamStats").get("topAssists")&&e.get("teamStats").get("topAssists").slice(0,4),e.get("teamStats").get("topGoals")&&e.get("teamStats").get("topGoals").slice(0,4),e.get("teamStats").get("topShots")&&e.get("teamStats").get("topShots").slice(0,4),t(e.get("teamStats"))},function(e){console.log("Error: "+e.code+" "+e.message),t({error:"Someting happened"})})},G=function(e){var t=new y;return t.set("ageGroup",e.ageGroup),t.set("city",e.city),t.set("leagueName",e.leagueName),t.set("name",e.name),t.set("number",e.number),t.set("state",_.invert(c)[e.state]),t.set("logo",e.logo),t.set("primaryColor",e.primaryColor),t.set("teamStats",new f),t},A=function(e,t,s){t.save(null,{success:function(t){var r=new Parse.User;r.set("username",e.email),r.set("firstName",e.firstName),r.set("lastName",e.lastName),r.set("name",e.firstName+" "+e.lastName),r.set("email",e.email),r.set("password",e.password),r.set("phone",e.phone),r.set("city",e.city),r.set("state",_.invert(c)[e.state]),r.set("photo",e.photo),r.addUnique("teams",t),r.set("accountType",1),r.signUp(null,{success:function(e){o.success(a.toasts.registrationSuccess),z(e,t.id,t.get("name"),s),n.goToPage("/home")},error:function(e,t){console.log("Error: "+t.code+" "+t.message),202===t.code&&o.error(t.message)}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},M=function(e,t,r){var l=i(),u=new m,d=new p,g=new Parse.Query(y);g.get(e.team.id,{success:function(i){r?(u.set("name",e.firstName+" "+e.lastName),u.set("firstName",e.firstName),u.set("lastName",e.lastName),u.set("jerseyNumber",e.jerseyNumber),u.set("team",i),u.set("playerStats",d)):(e.newPhoto&&u.set("photo",e.newPhoto),u.set("name",e.firstName+" "+e.lastName),u.set("firstName",e.firstName),u.set("lastName",e.lastName),u.set("birthday",e.birthday),u.set("team",i),u.set("jerseyNumber",e.jerseyNumber),u.set("city",e.city),u.set("state",_.invert(c)[e.state]),u.set("emergencyContact",e.emergencyContact.name),u.set("phone",e.emergencyContact.phone),u.set("relationship",e.emergencyContact.relationship),u.set("playerStats",d)),u.save(null,{success:function(r){e.parentId?Parse.Cloud.run("addPlayer",{newPlayerId:r.id,parentId:e.parentId},{success:function(e){console.log(e),o.success("Player "+r.name+", successfully added."),s.$broadcast(a.messages.playerAdded,r),n.closeModal(t)},error:function(e){console.log("Error: "+e.code+" "+e.message),o.error("There was an error ("+e.code+"). Please try again.")}}):(l.addUnique("players",r),l.save(null,{success:function(){o.success("Player "+e.name+", successfully added."),s.$broadcast(a.messages.playerAdded,r),n.closeModal(t)},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}}))},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},j=function(e,t){var r=i();e.save(null,{success:function(e){r.addUnique("teams",e),r.save(null,{success:function(){v(e),o.success(a.toasts.teamAddSuccess),n.closeModal(t),s.$broadcast(a.messages.addNewTeam,e),s.$broadcast(a.messages.teamChanged,{team:e,refresh:!0})},error:function(e,t){o.error("There was a an error ("+t.code+"). Please try again."),console.log(t.message)}})},error:function(e,t){o.error("There was a an error ("+t.code+"). Please try again."),console.log(t.message)}})},E=function(e,t){var s=i();s.set("username",e.email),s.set("firstName",e.firstName),s.set("lastName",e.lastName),s.set("name",e.firstName+" "+e.lastName),s.set("email",e.email),s.set("phone",e.phone),s.set("city",e.city),s.set("state",_.invert(c)[e.state]),e.newPhoto&&s.set("photo",e.newPhoto),""!==e.newPassword&&s.set("password",e.newPassword),s.save(null,{success:function(){o.success(a.toasts.accountUpdateSuccess),n.closeModal(t)},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},O=function(e,t,s){var r=new Parse.Query(y);r.get(e,{success:function(e){e.set("leagueName",t.leagueName),e.set("ageGroup",t.ageGroup),e.set("primaryColor",t.primaryColor),e.set("city",t.city),e.set("name",t.name),e.set("number",t.number),e.set("state",_.invert(c)[t.state]),t.newLogo&&e.set("logo",t.newLogo),e.save(null,{success:function(e){v(e),o.success(a.toasts.teamUpdateSuccess),n.closeModal(s)},error:function(e,t){o.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){o.error("There was a an error ("+t.code+"). Please try again.")}})},U=function(e,t){var r=new Parse.Query(m);r.get(e.id,{success:function(l){r=new Parse.Query(y),r.get(e.team.id,{success:function(r){e.newPhoto&&l.set("photo",e.newPhoto),l.set("name",e.name),l.set("birthday",e.birthday),l.set("team",r),l.set("jerseyNumber",e.jerseyNumber),l.set("city",e.city),l.set("state",_.invert(c)[e.state]),l.set("emergencyContact",e.emergencyContact.name),l.set("phone",e.emergencyContact.phone),l.set("relationship",e.emergencyContact.relationship),l.save(null,{success:function(r){e.parentId?(k(e.id),Parse.Cloud.run("addPlayer",{newPlayerId:r.id,parentId:e.parentId},{success:function(){o.success("Player "+e.name+", successfully added."),s.$broadcast(a.messages.teamChanged,{refresh:!0}),n.closeModal(t)},error:function(e){console.log("Error: "+e.code+" "+e.message),o.error("There was an error ("+e.code+"). Please try again.")}})):(o.success("Player "+e.name+"'s profile updated."),s.$broadcast(a.messages.teamChanged,{refresh:!0}),n.closeModal(t))},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},k=function(e){Parse.Cloud.run("removePlayer",{playerId:e},{success:function(){console.log("remove player from parent successful")},error:function(e){console.log("Error: "+e.code+" "+e.message),o.error("There was an error ("+e.code+"). Please try again.")}})},q=function(e,s){var a=new Parse.Query(y);a.equalTo("objectId",e),a.first({success:function(e){t(function(){s(e)})},error:function(e,t){o.error("There was an error ("+t.code+"). Please try again.")}})},D=function(e,s){var a=new Parse.Query(m);a.equalTo("team",{__type:"Pointer",className:"Team",objectId:e}),a.find({success:function(e){t(function(){s(e)})},error:function(e){o.error("There was an error ("+e.code+"). Please try again.")}})},Q=function(e,s){var a=new Parse.Query(p);a.equalTo("objectId",e),a.first({success:function(e){t(function(){s(e)})},error:function(e,t){o.error("There was an error ("+t.code+"). Please try again.")}})},x=function(e,s){var a=new Parse.Query(m);a.equalTo("objectId",e),a.first({success:function(e){t(function(){s(e)})},error:function(e){console.log("Error: "+e.code+" "+e.message),o.error("There was a an error ("+e.code+"). Please try again.")}})},W=function(e){var t=new Parse.Query(h);return t.include("gameTeamStats"),t.equalTo("objectId",e),t.first()},$=function(e){var t=new Parse.Query(b);return t.equalTo("objectId",e),t.include("roster"),t.include("roster.player"),t.include("substitutions"),t.include("substitutions.subbedIn"),t.include("substitutions.subbedOut"),t.include("substitutions.subbedIn.player"),t.include("substitutions.subbedOut.player"),t.first()},K=function(e,t){var s=new Parse.Query(g);s.equalTo("teams",{__type:"Pointer",className:"Team",objectId:e}),s.equalTo("accountType",2),s.find({success:function(e){t(e)},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},L=function(e,t){var s=new Parse.Query(g);s.equalTo("players",{__type:"Pointer",className:"Players",objectId:e}),s.equalTo("accountType",2),s.first({success:function(e){t(e)},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},V=function(e){var t=new Parse.Query(h);return t.equalTo("objectId",e),t.first()},H=function(e,t){console.log(e),console.log(t);var r=new h;r.set("date",e.date),r.set("opponent",e.opponent.name),r.set("opponentSymbol",e.opponent.symbol),r.set("startTime",e.time.toTimeString()),r.set("team",{__type:"Pointer",className:"Team",objectId:t}),r.set("gameTeamStats",new b),r.set("status","not_started"),r.save(null,{success:function(){o.success("Game on "+(e.date.getMonth()+1)+"/"+e.date.getDate()+" added."),s.$broadcast(a.messages.gameStatusChanged)},error:function(e,t){console.log("Error saving game: "+t.code+" "+t.message),o.error("There was an error ("+t.code+"). Please try again.")}})},R=function(e,t,s){var a=new Parse.Query(h);a.equalTo("objectId",e.id),a.first({success:function(e){console.log(e);for(var a=0;a<t.length;a++)e.set(t[a],s[a]);e.save(null,{success:function(){o.success("Successfully saved game notes.")},error:function(){o.error("There was an error.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},Y=function(e,t){var r=[],l={},c=new Parse.Promise,i=function(e){var t=0;return _.each(e,function(e){e.selected&&t++}),t},u=i(e);_.each(e,function(e){if(e.selected){var t={__type:"Pointer",className:"Players",objectId:e.id},s=new P;s.set("player",t),s.set("shots",[]),s.set("passes",{}),s.set("cards",[]),s.set("fouls",0),s.set("playingTime",0),s.set("subbedOut",[]),s.set("subbedIn",[]),s.set("assists",0),s.set("tackles",0),s.set("x",e.x),s.set("y",e.y),s.set("posId",e.posId),e.benched?s.set("startingStatus","Off"):s.set("startingStatus","On"),e.position?s.set("position",e.position):s.set("position","B"),s.save().then(function(e){r.push(e),r.length==u&&c.resolve("ok")})}}),c.then(function(){query=new Parse.Query(h),query.include("gameTeamStats"),query.equalTo("objectId",t),query.first().then(function(e){l=e;var t=e.get("gameTeamStats");return t.set("roster",r),t.set("goalsMade",0),t.set("goalsTaken",0),t.set("possession",0),t.set("corners",0),t.set("offsides",0),t.set("tackles",0),t.set("saves",0),t.set("substitutions",[]),t.set("fouls",0),t.set("passes",0),t.save()}).then(function(){return l.set("status","ready"),l.save()}).then(function(e){w(e),s.$broadcast(a.messages.gameStatusChanged),o.success("Game roster successfully created"),n.goToPage("/game-review")},function(e){console.log("Error: "+e.code+" "+e.message)})})},F=function(e,t){var s={id:e.id,photo:e.attributes.photo?e.attributes.photo._url:"./img/player-icon.svg",fname:e.attributes.firstName,lname:e.attributes.lastName,number:e.attributes.jerseyNumber,position:"",total:{goals:t.attributes.goals?t.attributes.goals:0,fouls:t.attributes.fouls?t.attributes.fouls:0,playingTime:t.attributes.playingTime?Math.round(t.attributes.playingTime):0,assists:t.attributes.assists?t.attributes.assists:0,yellows:0,reds:0,cardInit:function(e,t){card=t.attributes.cards,e.yellows=card.yellow,e.reds=card.red}},shots:{data:[{value:0,color:"#B4B4B4",highlight:"#B4B4B4",label:"Missed"},{value:0,color:"#5DA97B",highlight:"#5DA97B",label:"Completed"}],accuracy:0,goals:0,shotInit:function(e,t){var s=0,a=0,o=0,r=t.attributes.shots;s=r.blocked,a=r.onGoal,o=r.offGoal,e.goals=r.goal;var n=s+a+o+e.goals;e.accuracy=Math.round((n-o)/n*100),console.log(e.accuracy),e.data[0].value=o,e.data[1].value=n}},passes:{data:[{value:0,color:"#B4B4B4",highlight:"#B4B4B4",label:"Completed"},{value:0,color:"#5DA97B",highlight:"#5DA97B",label:"Total"}],completed:0,total:0,passInit:function(e,t){pass=t.attributes.passes,e.completed=pass.completed,e.total=pass.total,e.data[0].value=e.completed,e.data[1].value=e.total}},emergencyContact:{name:e.attributes.emergencyContact,phone:e.attributes.phone,relationship:e.attributes.relationship}};return t.attributes.cards&&s.total.cardInit(s.total,t),t.attributes.shots&&s.shots.shotInit(s.shots,t),t.attributes.passes&&s.passes.passInit(s.passes,t),s},J=function(e,t){var s={gameId:t.id,playerId:e.id,fname:e.get("firstName"),lname:e.get("lastName"),number:e.get("jerseyNumber"),photo:e.get("photo")?e.get("photo")._url:"./img/player-icon.svg",position:t.get("position")?t.get("position"):"",x:t.get("x")?t.get("x"):0,y:t.get("y")?t.get("y"):0,benched:"On"!==t.get("startingStatus")?!0:!1,myKid:!0,notableEvents:[],eventsInit:function(e,t,s){t&&_.each(t,function(t){e.notableEvents.push({type:"Subbed Out",time:moment.duration(t).minutes()})}),s&&_.each(s,function(t){e.notableEvents.push({type:"Subbed In",time:moment.duration(t).minutes()})})},total:{fouls:t.get("fouls")?t.get("fouls"):0,assists:t.get("assists")?t.get("assists"):0,playingTime:t.get("playingTime")?moment.duration(t.get("playingTime")).minutes():0,red:{total:0,time:[]},yellow:{total:0,time:[]},cardInit:function(e,t){playerCards=e.total,_.each(t,function(t){"red"==t.type?(playerCards.red.total++,playerCards.red.time.push(t.time),e.notableEvents.push({type:"red",time:moment.duration(t.time).minutes()})):"yellow"==t.type&&(playerCards.yellow.total++,playerCards.yellow.time.push(t.time),e.notableEvents.push({type:"yellow",time:moment.duration(t.time).minutes()}))})}},passes:{data:[{value:0,color:"#B4B4B4",highlight:"#B4B4B4",label:"Completed"},{value:0,color:"#5DA97B",highlight:"#5DA97B",label:"Total"}],completed:0,total:0,passInit:function(e,t){e.completed=t.completed?t.completed:0,e.total=t.total?t.total:0,e.data[0].value=t.completed?t.completed:0,e.data[1].value=t.total?t.total:0}},shots:{data:[{value:0,color:"#B4B4B4",highlight:"#B4B4B4",label:"Attempted"},{value:0,color:"#5DA97B",highlight:"#5DA97B",label:"Completed"}],accuracy:0,total:0,blocks:{total:0,startPos:[],resultPos:[]},onGoal:{total:0,startPos:[],resultPos:[]},offGoal:{total:0,startPos:[],resultPos:[]},goals:{total:0,startPos:[],resultPos:[],time:[],assistedBy:[]},shotInit:function(e,t){playerShots=e.shots,t&&_.each(t,function(t){switch(t.type){case"off":playerShots.offGoal.total++,playerShots.offGoal.startPos.push(t.shotPos),playerShots.offGoal.resultPos.push(t.resultPos);break;case"on":playerShots.onGoal.total++,playerShots.onGoal.startPos.push(t.shotPos),playerShots.onGoal.resultPos.push(t.resultPos);break;case"goal":playerShots.goals.total++,playerShots.goals.startPos.push(t.shotPos),playerShots.goals.resultPos.push(t.resultPos);var s=moment.duration(t.time).minutes();playerShots.goals.time.push(s),t.assistedBy&&playerShots.goals.assistedBy.push(t.assistedBy),e.notableEvents.push({type:"goal",time:s});break;case"blocked":playerShots.blocks.total++,playerShots.blocks.startPos.push(t.shotPos),playerShots.blocks.resultPos.push(t.resultPos)}});var s=playerShots.blocks.total+playerShots.onGoal.total+playerShots.offGoal.total+playerShots.goals.total;playerShots.total=s,0!=s?playerShots.accuracy=Math.round((s-playerShots.offGoal.total)/s*100):0,playerShots.data[0].value=playerShots.offGoal.total,playerShots.data[1].value=s}}};return t.get("cards")&&s.total.cardInit(s,t.get("cards")),(t.get("subbedOut")||t.get("subbedIn"))&&s.eventsInit(s,t.get("subbedOut"),t.get("subbedIn")),t.get("passes")&&s.passes.passInit(s.passes,t.get("passes")),t.get("shots")&&s.shots.shotInit(s,t.get("shots")),s},z=function(e,t,s,a,o){_.each(a,function(a){r.sendEmailInvite(e.get("name"),t,s,a)}),n.closeModal(o)};return{ageGroups:l,states:c,getTeams:I,getTeamById:q,getPlayersByTeamId:D,setCurrentTeam:v,getCurrentTeam:S,setCurrentGame:w,getCurrentGame:T,registerTeam:G,getPlayers:N,getCurrentUser:i,getSeasonPlayerStatsByPlayerId:Q,getGames:C,playerConstructor:F,getPlayerByPlayerId:x,getSeasonTeamStats:B,saveGame:H,saveGameAttributes:R,getGameStatsById:W,registerCoach:A,sendEmailInvite:z,updateAccount:E,updateTeam:O,registerPlayer:M,updatePlayer:U,registerNewTeam:j,getParentEmailsByTeamId:K,getParentByPlayerId:L,getGamePlayerStatsById:$,gamePlayerConstructor:J,getGameByGameId:V,createRoster:Y}});